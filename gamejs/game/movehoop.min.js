!function(e){var t=function(){};t.prototype=new Sprite,JY.extend(t.prototype,{create:function(){this.init(5,5,{backgroundColor:"#FFFFFF"})}});var i=function(){};i.prototype=new Sprite,JY.extend(i.prototype,{create:function(e){this.init(50,50,{backgroundColor:"#FFFFFF",borderRadius:"5px",fontStyle:"normal",fontSize:"16px",fontWeight:"bold",fontFamily:"微软雅黑",color:"#4d4d4d",lineHeight:"50px",textAlign:"center",cursor:"pointer"}),this.DOM.innerHTML=e}});var o=function(){},n=function(){};n.prototype=new Game,g=new n,JY.extend(n.prototype,{newGame:function(){this.levelArr=["level1","level2","level3","level3","level4","level5","level6","level7","level8","level9","level10","level11","level12","level13","level14","level15","level16","level17","level18","level19","level20"],this.levelKey=["!@#","#@!","sa","erq","!@#1","#@!2","sa中","fe3","!sel","iow!","q3","6ff","56w","al3","3d","a3d","3LK","ailk","@#%D","$#$","!^^","SE!","WD","BDA","MC","WC!","EFS","DE"],this.levelSpriteArr=[],this.currentLevel=1,this.currentLevelArr=[],this.pointArr=[],this.currentConfig={},this.dragPos={},e.levelObject={},this.moveEnabled=!1,this.lastPoint=null,this.life=1,this.isFire=!1,this.user=null,this.shiArr=[],this.speed=5,this.showLevel(),JY.soundManage.play("bg",!0)},showLevel:function(){r.clearState();var e=this;JY.each(this.levelArr,function(t,o){var n=new i;n.create(o+1),n.data=o+1,r.addChild(n);var s=o%8*(n.width+10)+100,l=parseInt(o/8)*(n.height+10)+100;n.setPosition(s,l),e.levelSpriteArr.push(n);var h=JY.cookie("level")||1,a=JY.cookie("levelKey")||"!@#";e.levelKey[h]!==a&&(h=1),o+1>h&&(n.setStyle({backgroundColor:"gray"}),n.lock=!0)}),this.selectLevel()},selectLevel:function(){var e=this;JY.each(e.levelSpriteArr,function(t,i){!function(t){JY.bind(t.DOM,"mousedown",function(i){t.lock||e.startLevel(t.data)})}(t)})},startLevel:function(e){r.clearState();var t=this;this.currentLevel=e,this.speed=Math.min(this.currentLevel+3,15),JY.loadFile("/game/level/movehoop/level"+e+".js","script",function(){t.drawMap(),t.user.setPosition(0,JY.height(r.stage)/2),t.moveEnabled=!1})},drawMap:function(){var t=this;this.currentLevelArr=e.levelObject["level"+this.currentLevel].arr,this.currentConfig=e.levelObject["level"+this.currentLevel].config,JY.draw.setStyle(JY.extend({position:"absolute",fontSize:"1px",background:"url(images/movehoop/rope.png) no-repeat"},this.currentConfig)),JY.each(this.currentLevelArr,function(e){JY.resolve(function(e,i){t.pointArr.push(JY.draw.point(r.stage,e.x,e.y))},0,e.length,e)}),this.lastPoint=t.pointArr[t.pointArr.length-1],JY.css(this.lastPoint,{background:"#000"}),this.createHoop()},createHoop:function(){this.user=new Sprite(16,20,{border:"none",background:"url(images/movehoop/fire.gif) -3px 0px no-repeat"}),this.user.setPosition(0,JY.height(r.stage)/2),r.addChild(this.user),this.bindEvent(),r.startTimer()},bindEvent:function(){var e=this;JY.bind(e.user.DOM,"mousedown",function(t){var i=e.getEventPosition(t);e.dragPos={x:i.x-e.user.x,y:i.y-e.user.y},e.moveEnabled=!0,JY.bind(document,"mousemove",JY.proxyFunc(e.moveUser,e))}).bind(document,"mouseup",function(){e.moveEnabled=!1,JY.unbind(document,"mousemove")})},getEventPosition:function(e){var t=r.stage,i=JY.offset(t),o=0,n=0;return o=e.clientX-i.x+document.documentElement.scrollLeft,n=e.clientY-i.y+document.documentElement.scrollTop,{x:o,y:n}},moveUser:function(e){var t=this;if(t.moveEnabled){var i=this.getEventPosition(e),o=i.y-this.dragPos.y,n=i.x-this.dragPos.x;(Math.abs(n-this.user.x)>=1||Math.abs(o-this.user.y)>=1)&&(0>n?n=0:n>JY.width(r.stage)-t.user.width&&(n=JY.width(r.stage)-t.user.width),0>o?o=0:o>JY.height(r.stage)-t.user.height&&(o=JY.height(r.stage)-t.user.height),this.user.setPosition(n,o),this.testHits())}},runGame:function(){this.checkLife(),this.fireRope(),this.createShi(),this.shiAnimate(),this.checkShiHit(),this.checkStage()},checkStage:function(){JY.height(r.stage)!==r.stage.height&&JY.height(r.stage,r.stage.height),JY.width(r.stage)!==r.stage.width&&JY.width(r.stage,r.stage.width)},checkShiHit:function(){if(!this.isFire){var e=this;JY.resolve(function(t,i){JY.hits(t,e.user)&&e.life--},0,e.shiArr.length,e.shiArr)}},shiAnimate:function(){var e=this;JY.resolve(function(t,i){t.y+=e.speed,t.setPosition(t.x,t.y),t.y>JY.height(r.stage)&&(r.removeChild(t.DOM),delete t)},0,this.shiArr.length,this.shiArr)},createShi:function(){var e=Math.floor(250*Math.random());if(e<Math.min(this.currentLevel,5)){var t=new Sprite(24,24),i=this.user.x;t.setPosition(i,-24),t.setStyle({background:"url(images/movehoop/shi.png) no-repeat"}),r.addChild(t),this.shiArr.push(t)}},fireRope:function(){if(this.isFire){var e=this.pointArr.slice(-5),t=this;if(JY.each(e,function(e,i){JY.css(e,{background:"#000"}),t.pointArr.pop()}),0===this.pointArr.length){if(this.isFire=!1,this.shiArr=[],this.shiArr.length=0,this.levelArr.length==this.currentLevel)return this.createFlower(),alert("你撸管的小手挺稳的，希望你撸出一个新的春天，菊花收好！游戏已经通关，是否重玩一次？"),void this.startLevel(1);this.startLevel(this.currentLevel)}}},createFlower:function(){for(var e=0;100>e;e++){var t=new Sprite(23,23),i=Math.random()*r.stage.width,o=Math.random()*r.stage.height;t.setPosition(i,o),t.setStyle({background:"url(images/movehoop/flower.png) no-repeat"}),r.addChild(t)}},checkLife:function(){this.life<=0&&(alert("游戏结束,手残人士，请再接再厉吧!"),r.clearState(),this.newGame(),JY.soundManage.stop("bg",!0))},testHits:function(){var e=this;JY.resolve(function(t,i){return JY.hits(e.user,e.lastPoint)?(e.levelup(),!1):void(JY.hits(t,e.user,1)&&e.life--)},0,e.pointArr.length,e.pointArr)},levelup:function(){this.moveEnabled=!1,this.currentLevel++;var e=JY.cookie("level")||1;e=Math.max(this.currentLevel,e),JY.cookie("level",e,30),JY.cookie("levelKey",this.levelKey[e],30),this.isFire=!0}}),o.prototype=new JYG(JY.byId("gameboard")),JY.extend(o.prototype,{init:function(){this.frequency=50,this.game=g,this.waitTime=5,this.checkState(JYGSTATE.STATE_SYSTEM_TITLE),this.startTimer(),this.titleScreen=JY.convertDOM('<div style="color:red;font-weight:bold;text-align:center;padding-top:50px;width:100%;margin:0 auto;"><h1 style="color:red;font-weight:bold;">点燃火绳-JY游戏</h1></div>'),this.InstructionsScreen=JY.convertDOM('<div style="margin:0 auto;height:100%;width:100%;position:relative;"><span style="display:block;cursor:pointer;width:275px;height:110px;line-height:100px;font-family: Tahoma,宋体;text-align:center;font-size:28px;font-weight:bolder;color:#FFFFFF;top:200px;left:180px;position:absolute;">Play</span><p style="position:absolute;top:350px;left:180px;color:#0091e0;"><a href="http://www.lovewebgames.com" target="_blank" style="color:#0091e0;">作者：田想兵55342775@qq.com</a></p></div>'),this.scoreScreen=JY.convertDOM('<div style="color:#FFF;width:200px;float:right;font-weight:bold;position:absolute;z-index:2;right:0;" id="scoreScreen"></div>'),JY.delegate(JY.byId("gameboard"),"a","mousedown",function(e){location.href=JY.attr(e.target,"href")}),JY.soundManage.init("/scripts/swfobject.min.js","/scripts/flash/playSound.swf","playSound",function(){JY.soundManage.loadSound("sound/zuma/bg.mp3","bg")}),JY.bind(document,"keydown",function(e){g.bindEvent(e.keyCode)});var e=JY.convertDOM('<p style="font-size:12px;">资源正在加载中。。。</p>');this.addChild(e);var t=this;JY.loadFile("/scripts/JY.cookie.js","script",function(){t.removeChild(e)})}});var r=new o;r.init(),"www.lovewebgames.com"!==location.host&&"localhost"!==location.hostname&&(location.href="http://www.lovewebgames.com")}(window);