!function(t){var i=function(){},e=function(){};e.prototype=new Game,g=new e,t.extend(e.prototype,{newGame:function(){this.level=0,this.life=3,this.v=15,this.hitsArr=[],this.scoreType=[1,2,5,-5],this.killArr=[0,0,0,0,0,0,0,0],this.T=null,this.score=0,this.wait=30,this.count=40,this.sc=0,this.drawToolbar(),this.drawMap()},runGame:function(){this.creaetMole(),this.checkLife(),this.animateMole(),this.createT(),this.kill(),this.checkScore(),this.getScore(),this.checkLevel()},checkLevel:function(){this.level=Math.floor(this.score/10),this.wait=Math.max(30-this.level,0)},bindEvent:function(){var i=this;t.touch(s.stage,function(e){if(7==s.currentState){var h=e,o={x:h.pageX-i.T.width/4,y:h.pageY-i.T.height/2};return i.T.setPosition(o.x,o.y),i.T.data=3,t.addClass(i.T.DOM,"zoomIn animated"),!1}}),t.bind(s.stage,"touchmove",function(t){if(7==s.currentState){var e=t.changedTouches[0],h={x:e.pageX-i.T.width/4,y:e.pageY-i.T.height/2};return i.T.setPosition(h.x,h.y),!1}}),t.bind(s.stage,"mousemove",function(t){if(7==s.currentState&&i.T){var e=t,h={x:e.pageX-i.T.width/4,y:e.pageY-i.T.height/2};i.T.setPosition(h.x,h.y)}})},getScore:function(){var i=this;t.resolve(function(e,s){var h=i.scoreTool,o=e,a=i.v,r=h.x+h.width/2-o.x,l=h.y+h.height/2-o.y,n=Math.atan2(r,l);o.x+=Math.floor(Math.sin(n)*a),o.y+=Math.floor(Math.cos(n)*a);var c=o.data;c.width=.95*c.width,c.height=.95*c.height,t.width(o.DOM,c.width),t.height(o.DOM,c.height),t.width(c.DOM,c.width),t.height(c.DOM,c.height);var d=.98*(t.css(c.DOM,"opacity")||1);c.setStyle({opacity:d}),o.setPosition(),t.hits(o,h)&&(c.remove(),delete c,o.remove(),delete o,delete i.hitsArr[s])},0,this.hitsArr.length,this.hitsArr)},kill:function(){if(this.T.data){this.T.data--,0==this.T.data&&t.removeClass(this.T.DOM,"zoomIn").removeClass(this.T.DOM,"animated");var i=this;t.resolve(function(e,h){var o=e.data;if(o){var a=o.data;if(a&&t.hits(o,{x:i.T.x,y:i.T.y,width:i.T.width/2,height:i.T.height})){i.hitsArr.push(o),i.score+=a.score,i.killArr[a.type]++,e.data=null;var r=new Sprite(30,30);t.text(r.DOM,a.score>0?"+"+a.score:a.score),t.css(r.DOM,{color:"#fff",fontSize:"28px",fontWeight:"bold",zIndex:999}),r.setPosition(i.T.x+20,i.T.y-20),s.addChild(r),function(t){setTimeout(function(){t.remove()},500)}(r)}}},0,this.pullArr.length,this.pullArr)}},checkScore:function(){t.text(this.scoreTool.DOM,"得分:"+this.score),this.score>100&&t.addClass(s.stage,"highbg")},createT:function(){this.T||(this.T=new Sprite(this.holeW,this.holeW/2),t.addClass(this.T.DOM,"T"),this.T.setPosition(s.stage.width/3,s.stage.height/3),s.addChild(this.T))},drawMap:function(){var i=s.stage.width/3,e=s.stage.height/4;this.holeW=i,this.holeH=e,this.pullArr=[];for(var h=0,o=12;o>h;h++){var a={};a.x=h%3*i;var r=Math.floor(h/3);a.y=r*e+20;var l=new Sprite(.8*i,.8*i);l.setPosition(a.x,a.y),t.addClass(l.DOM,"hole"),s.addChild(l),this.pullArr.push(l)}},drawToolbar:function(){var i=new Sprite(s.stage.width,20);this.scoreTool=new Sprite(100,20),t.text(this.scoreTool.DOM,"得分:0"),this.lifeTool=new Sprite(s.stage.width-110,20),this.lifeTool.setPosition(110,0),i.addChild(this.lifeTool),i.addChild(this.scoreTool),s.addChild(i)},creaetMole:function(){if(this.sc+Math.floor(10*Math.random())>=this.count-2*this.level){this.sc=0;var i=this.holeW/2*1.333,e=this.pullArr.length,h=Math.floor(Math.random()*e),o=this.pullArr[h];if(o&&!o.data){{var a=new Sprite(this.holeW/2,0),r=new Sprite(this.holeW/2,i);Math.random()*(t.width(s.stage)-r.width)}a.time=0,a.wait=this.wait,a["for"]=0,o.data=a,a.setPosition(o.x+(this.holeW-o.width)/2,o.y+o.height/2);var l=Math.ceil(4*Math.random());this.score>100?(r.score=10,r.type=l+4-1,t.addClass(r.DOM,"d-"+l)):(r.score=this.scoreType[l-1],r.type=l-1,t.addClass(r.DOM,"c-"+l)),a.data=r,a.addChild(r),s.addChild(a)}}this.sc++},animateMole:function(){var i=this;t.resolve(function(e,s){if(e.data){var h=e.data,o=h.data,a=(h.time,o.height/15);if(h.time<10&&0==h["for"]){var r=a*h.time;t.height(h.DOM,r),h.height=r,h.setPosition(h.x,h.y-.7*a),h.time++}if(10==h.time&&h.wait&&(h.wait--,t.addClass(h.DOM,"hehe")),!h.wait&&(10==h.time||1==h["for"])){h["for"]=1;var r=a*h.time;t.height(h.DOM,r),h.height=r,h.setPosition(h.x,h.y+.7*a),h.time--}h.time<=0&&(o.score>0&&(i.life-=1),o.remove(),h.remove(),h=null,o=null,e.data=null)}},0,this.pullArr.length,this.pullArr)},checkLife:function(){if(this.life<=0){t.removeClass(s.stage,"highbg");var i=parseInt(t.cookie("klm"))||0;i=Math.max(i,this.score),t.cookie("klm",i,30);var e="",h="";this.score>100&&this.score<1e3?(e="您获得 百人斩 称号,",h='<p><i class="d-1"></i> x '+this.killArr[4]+' <i class="d-2"></i> x '+this.killArr[5]+' <i class="d-3"></i> x '+this.killArr[6]+' <i class="d-4"></i> x '+this.killArr[7]+"</p>"):this.score>1e3&&(e="您获得 千人斩 称号,",h='<p><i class="d-1"></i> x '+this.killArr[4]+' <i class="d-2"></i> x '+this.killArr[5]+' <i class="d-3"></i> x '+this.killArr[6]+' <i class="d-4"></i> x '+this.killArr[7]+"</p>"),s.gameOverScreen=t.convertDOM('<div style="padding:50% 0px;width:300px;margin:0 auto; position:relative;" class="gameover"><div style="position:absolute;background:url(images/Whac-A-Mole/cat.png) no-repeat center center ;background-size:200px;opacity:0.2;position:absolute;top:20%;left:0;width:100%;height:300px;"></div><div style="position:absolute;top:50%;left:0;z-index:2;"><h1>游戏结束!</h1>'+e+"<p>您在本次游戏中共打了"+this.score+'分</p><p><i class="c-1"></i> x '+this.killArr[0]+' <i class="c-2"></i> x '+this.killArr[1]+' <i class="c-3"></i> x '+this.killArr[2]+' <i class="c-4"></i> x '+this.killArr[3]+"</p><p>历史最高得分："+i+"</p>"+h+"<p>猛击之后重新来过！</p></div></div>");var o=t.convertDOM('<p style="position:absolute;bottom:0;right:0;color:#fff;z-index:99;">点击进入卡乐猫商城</p>');t.touch(o,function(){return location.href="http://v.ewanse.com/",!1}),t.append(s.gameOverScreen,o),s.checkState(JYGSTATE.STATE_SYSTEM_GAME_OVER)}}}),i.prototype=new JYG(t.byId("gameboard")),t.extend(i.prototype,{init:function(){this.game=g,this.frequency=30,this.waitTime=5,this.checkState(JYGSTATE.STATE_SYSTEM_TITLE),this.startTimer(),this.titleScreen=t.convertDOM('<div style="color:#555;padding:50% 0px;width:300px;margin:0 auto;position:relative;"><h1>打卡乐猫</h1><div style="position:absolute;background:url(images/Whac-A-Mole/cat.png) no-repeat center center ;background-size:200px;opacity:0.2;position:absolute;top:20%;left:0;width:100%;height:300px;"></div></div>');var i=this.stage.height/3,e=this.stage.width/3;this.InstructionsScreen=t.convertDOM('<div style="padding:0px;width:300px;margin:0 auto; position:absolute;top:'+i+"px;left:"+e+'px;"><div style="position:absolute;background:url(images/Whac-A-Mole/cat.png) no-repeat center center ;background-size:200px;opacity:0.2;position:absolute;top:20%;left:0;width:100%;height:300px;"></div><h1>打卡乐猫</h1><p>点击开始游戏</p>作者：田想兵55342775@qq.com</div>'),this.scoreScreen=t.convertDOM('<div style="color:#555;width:100px;float:right;" id="scoreScreen"></div>'),t.loadFile("images/Whac-A-Mole/cat.png,images/Whac-A-Mole/cat1.png,images/Whac-A-Mole/cat2.png,images/Whac-A-Mole/cat3.png,images/Whac-A-Mole/cat4.png,images/Whac-A-Mole/d1.jpg,images/Whac-A-Mole/d2.jpg,images/Whac-A-Mole/d3.jpg,images/Whac-A-Mole/d4.jpg,images/Whac-A-Mole/hole.png,images/Whac-A-Mole/t.png","image")}});var s=new i;s.init(),g.bindEvent()}(JY);