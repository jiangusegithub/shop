!function(){var e=function(){},t=function(){this.goldArr=[],this.level=1,this.speed=10,this.score=0,this.life=1};t.prototype=new Game,g=new t,JY.extend(t.prototype,{newGame:function(){this.monsterArr=[],this.level=1,this.speed=5,this.score=0,this.life=5,this.magic=100,this.timer=+new Date,i.checkState(JYGSTATE.STATE_SYSTEM_NEW_LEVEL),this.user=this.createUser(),this.userSpeed=5,this.monsterSort=0,JY.css(i.stage,{background:"url(images/skyBG.jpg) repeat-x"}),this.backX=0,this.vx=0,this.vy=0,this.bulletArr=[],this.shootSpeed=20,this.monsterSpeed=3,this.isEnd=!1,this.monsterBulletArr=[],this.monsterShootSpeed=15,i.addChild(i.lifeScreen),i.addChild(i.monsterLifeScreen),this.shootting=!1,this.addControl(),this.shootTimer=null},addControl:function(){var e=JY.convertDOM('<div style="width:130px;height:130px;position:absolute;left:10px;bottom:10px;" id="CONTROL"><div  style="position:absolute;left:45px;top:0;width:40px;height:40px;border:1px solid #DEDEDE;text-align:center;line-height:40px;background:url(images/up.gif) no-repeat center;color:#282828;font-weight:bolder;" rel="87">W</div><div  style="position:absolute;left:45px;bottom:0;width:40px;height:40px;border:1px solid #DEDEDE;text-align:center;line-height:40px;background:url(images/down.gif) no-repeat center;color:#282828;font-weight:bolder;" rel="83">S</div><div  style="position:absolute;left:0;top:45px;width:40px;height:40px;border:1px solid #DEDEDE;text-align:center;line-height:40px;background:url(images/left.gif) no-repeat center;color:#282828;font-weight:bolder;" rel="65">A</div><div  style="position:absolute;right:0;top:45px;width:40px;height:40px;border:1px solid #DEDEDE;text-align:center;line-height:40px;background:url(images/right.gif) no-repeat center;color:#282828;font-weight:bolder;" rel="68">D</div><div  style="position:absolute;left:600px;top:45px;width:40px;height:40px;border:1px solid #DEDEDE;text-align:center;line-height:40px;background:url(images/tjsfire.jpg) no-repeat center;color:blue;font-weight:bolder;font-size:16px;" rel="74">J</div><div style="position:absolute;left:650px;top:45px;width:40px;height:40px;border:1px solid #DEDEDE;text-align:center;line-height:40px;background:url(images/dz.gif) no-repeat center;color:blue;font-weight:bolder;font-size:16px;" rel="75">K</div></div>');i.addChild(e),this.bindControlEvent()},bindControlEvent:function(){var e=this;JY.query("#CONTROL div").bind("mousedown",function(t){var i=JY.attr(this,"rel");e.EventUser(parseInt(i))}),JY.query("#CONTROL div").bind("mouseup",function(t){var i=JY.attr(this,"rel");e.EventUpUser(parseInt(i))})},createUser:function(){var e=new Sprite(50,50);e.direction=0;var t=e.width,s=(i.stage.height+e.height)/2;e.setPosition(t,s),JY.addClass(e.DOM,"user"),i.addChild(e.DOM);var r=this;return e.shoot=function(){var e=new Sprite(10,10);e.x=this.x+this.width,e.y=this.y+this.height/2,e.data={},JY.addClass(this.DOM,"shoot"),JY.addClass(e.DOM,"bullet"),i.addChild(e.DOM),e.setPosition(),r.bulletArr.push(e)},e.shootUp=function(){JY.removeClass(this.DOM,"shoot")},e.shootDZ=function(){if(r.magic<50)return!1;r.magic-=50;var e=new Sprite(200,200);e.x=this.x+this.width/2,e.y=this.y-e.height/2,JY.addClass(this.DOM,"shoot"),JY.addClass(e.DOM,"dazao"),i.addChild(e.DOM),e.setPosition(),e.data={},e.data.isDZ=!0,e.data.speed=20,r.bulletArr.push(e),this.shootTimer&&clearTimeout(this.shootTimer),this.shootTimer=setTimeout(function(){JY.removeClass(e.DOM,"dazao")},3e3)},e},EventUser:function(e){var t=this;if(i.currentState===JYGSTATE.STATE_SYSTEM_GAME_PLAY)switch(e){case 87:this.vy=-this.userSpeed;break;case 83:this.vy=this.userSpeed;break;case 65:this.vx=-this.userSpeed;break;case 68:this.vx=this.userSpeed;break;case 74:this.shootting||(this.user.shoot(),this.shootting=!0,setTimeout(function(){t.user.shootUp()},500));break;case 75:this.user.shootDZ()}},EventUpUser:function(e){if(this.shootting=!1,i.currentState===JYGSTATE.STATE_SYSTEM_GAME_PLAY){var t=e.keyCode||e;switch(t){case 87:case 83:this.vy=0;break;case 65:case 68:this.vx=0}this.user.shootUp()}},runGame:function(){this.creaetMonster(this.level),this.moveMonster(),this.checkLife(),this.checkLevel(),this.moveMaps(),this.moveUser(),this.moveBullet(),this.killMonster(),this.moveMonsterBullet()},moveUser:function(){this.user.x+=this.vx,this.user.y+=this.vy,this.user.x=Math.min(this.user.x,JY.width(i.stage)-this.user.width),this.user.x=Math.max(this.user.x,0),this.user.y=Math.min(this.user.y,JY.height(i.stage)-this.user.height),this.user.y=Math.max(this.user.y,0),this.user.setPosition(this.user.x,this.user.y)},moveBullet:function(){var e=this;JY.each(e.bulletArr,function(t,s){t.x+=e.shootSpeed,t.setPosition(),t.x>i.stage.width&&(i.removeChild(t.DOM),delete e.bulletArr[s],delete t.DOM,delete t)})},killMonster:function(){var e=this;JY.resolve(function(t,s){JY.each(e.monsterArr,function(r,o){JY.hits(t,r)&&(r.life--,i.monsterLifeScreen.innerHTML="怪物血量："+JY.progressbar(r.life,r.sumLife,200),r.life<=0&&(i.monsterLifeScreen.innerHTML="",i.removeChild(r.DOM),e.magic+=r.level,e.magic=Math.min(100*e.level,e.magic),10===r.level&&(e.score+=100,i.gameOverScreen=JY.convertDOM('<div style="color:#333;padding:200px 100px;width:500px;margin:0 auto;"><h2 style="color:#333;">恭喜你，你通关了，你真是个天才。你的最后得分：<strong>'+e.score+"</strong>分</h2><p>点击重新开始游戏</p><div>"),i.checkState(JYGSTATE.STATE_SYSTEM_GAME_OVER),JY.css(i.stage,{cursor:"default"})),e.monsterArr.splice(o,1),delete r,e.score++),t.data.isDZ?JY.each(e.monsterBulletArr,function(s,r){JY.hits(s,t)&&(i.removeChild(s.DOM),e.monsterBulletArr.splice(r,1),delete s)}):(i.removeChild(t.DOM),e.bulletArr.splice(s,1),delete t))})},0,this.bulletArr.length,this.bulletArr)},moveMaps:function(){this.backX+=this.speed,this.backX>=1447?this.backX=0:null,JY.css(i.stage,{backgroundPosition:-this.backX+"px 0"})},checkLevel:function(){i.scoreScreen.innerHTML="得分："+this.score+"分",this.score/this.level>=10&&(this.level++,this.monsterSort++,this.life+=this.level,this.life=Math.min(this.life,5*this.level)),i.lifeScreen.innerHTML="<span>生命：</span>"+JY.progressbar(this.life,5*this.level,100)+"<div class='blue'><span>魔法:</span>"+JY.progressbar(this.magic,100*this.level,100)+"</div><p>等级："+this.level+".lv</p>"},checkLife:function(){this.life<=0&&(i.gameOverScreen=JY.convertDOM('<div style="color:#333;padding:200px 100px;width:500px;margin:0 auto;"><h2 style="color:#333;">恭喜你，你挂了。你的最后得分：<strong>'+this.score+"</strong>分</h2><p>点击重新开始游戏</p><div>"),i.checkState(JYGSTATE.STATE_SYSTEM_GAME_OVER),JY.css(i.stage,{cursor:"default"}))},moveMonster:function(){var e=this;JY.resolve(function(t,s){t.x-=t.monsterSpeed,t.setPosition(t.x),t.x<-t.width&&(i.removeChild(t.DOM),delete t.DOM,delete t,e.monsterArr.splice(s,1));var r=Math.floor(500*Math.random());if(t&&r<t.level+5&&e.level<=10&&t.x>=e.user.x){var o=new Sprite(10,10);o.x=t.x,o.y=t.y+t.height/2;var n=e.user.x+e.user.width/2-o.x,h=e.user.y+e.user.height/2-o.y;o.data={},o.data.angle=Math.atan2(n,h),JY.addClass(o.DOM,"bullet2"),i.addChild(o.DOM),o.setPosition(),e.monsterBulletArr.push(o)}},0,this.monsterArr.length,this.monsterArr)},moveMonsterBullet:function(){var e=this;JY.resolve(function(t,s){t.x+=Math.sin(t.data.angle)*e.speed,t.y+=Math.cos(t.data.angle)*e.speed,t.setPosition(t.x,t.y),JY.hits(t,e.user,5)&&(e.life--,i.removeChild(t.DOM),delete e.monsterBulletArr[s],delete t.DOM,delete t),(t.y>i.stage.height||t.y<0||t.x<0||t.x>i.stage.width)&&(i.removeChild(t.DOM),e.monsterBulletArr.splice(s,1),delete t)},0,this.monsterBulletArr.length,this.monsterBulletArr)},creaetMonster:function(e){var t=Math.floor(100*Math.random());if(3+e/2>t){var s=new Sprite(50,52);switch(s.life=0,s.level=0,this.isEnd&&(s=new Sprite(60,60),JY.addClass(s.DOM,"five"),s.life=5,s.level=5,s.monsterSpeed=this.monsterSpeed*(Math.random()+.1)),e){case 1:s.life=1,s.level=1,s.monsterSpeed=this.monsterSpeed*(Math.random()+.1);break;case 2:s=new Sprite(60,44),JY.addClass(s.DOM,"two"),s.life=2,s.level=2,s.monsterSpeed=this.monsterSpeed*(Math.random()+.1);break;case 3:s=new Sprite(60,52),JY.addClass(s.DOM,"three"),s.life=3,s.level=3,s.monsterSpeed=this.monsterSpeed*(Math.random()+.1);break;case 4:s=new Sprite(60,56),s.width=60,s.height=56,JY.addClass(s.DOM,"four"),s.life=4,s.level=4,s.monsterSpeed=this.monsterSpeed*(Math.random()+.1);break;case 5:s=new Sprite(60,60),JY.addClass(s.DOM,"five"),s.life=5,s.level=5,s.monsterSpeed=this.monsterSpeed*(Math.random()+.1);break;case 6:s=new Sprite(40,80),JY.addClass(s.DOM,"six"),s.life=6,s.level=6,s.monsterSpeed=this.monsterSpeed*(Math.random()+.1);break;case 7:s=new Sprite(60,51),JY.addClass(s.DOM,"seven"),s.life=7,s.level=7,s.monsterSpeed=this.monsterSpeed*(Math.random()+.1);break;case 8:s=new Sprite(60,62),JY.addClass(s.DOM,"eight"),s.life=8,s.level=8,s.monsterSpeed=this.monsterSpeed*(Math.random()+.1);break;case 9:s=new Sprite(80,58),JY.addClass(s.DOM,"night"),s.life=9,s.level=9,s.monsterSpeed=this.monsterSpeed*(Math.random()+.1);break;default:this.isEnd||(s=new Sprite(200,188),JY.addClass(s.DOM,"ten"),this.isEnd=!0,s.monsterSpeed=0,s.life=100,s.level=10)}if(0===s.life)return;s.sumLife=s.life,s.direction=0;var r=i.stage.width-s.width,o=Math.random()*(i.stage.height-s.height);s.setPosition(r,o),s.data={x:this.user.x,y:this.user.y},JY.addClass(s.DOM,"monster"),i.addChild(s.DOM),this.monsterArr.push(s)}}}),e.prototype=new JYG(JY.byId("gameboard")),JY.extend(e.prototype,{init:function(){this.game=g,this.frequency=30,this.waitTime=5,this.checkState(JYGSTATE.STATE_SYSTEM_TITLE),this.startTimer(),this.titleScreen=JY.convertDOM('<div style="color:#333;padding:200px;width:300px;margin:0 auto;"><h1 style="color:#333;font-weight:bold;">兔基斯天空大作战</h1></div>'),this.InstructionsScreen=JY.convertDOM('<div style="color:#333;padding:200px;width:300px;margin:0 auto;"><h1 style="color:#333;">兔基斯天空大作战</h1><p>点击开始游戏</p><p>WSAD移动角色，J发射攻击,K发大招。</p><a>作者：田想兵</a>55342775@qq.com</div>'),this.scoreScreen=JY.convertDOM('<div style="color:#333;width:100px;float:right;" id="scoreScreen"></div>'),this.lifeScreen=JY.convertDOM('<div style="color:#333;width:250px;float:left;" id="lifeScreen"></div>'),this.monsterLifeScreen=JY.convertDOM('<div style="color:#333;width:200px;float:left;margin-left:50px;" id="monsterLifeScreen"></div>'),JY.bind(document,"keydown",function(e){g.EventUser(e.keyCode)}).bind(document,"keyup",JY.proxyFunc(g.EventUpUser,g));var e=JY.convertDOM('<p style="font-size:12px;">资源正在加载中。。。</p>');this.addChild(e);var t=this;JY.loadFile("images/tjs.gif,images/tjs2min.gif,images/tjsfire.jpg,images/kdyg/374-铁哑铃.png,images/kdyg/081-小磁怪.png,images/kdyg/132-百变怪.png,images/kdyg/173-小皮皮.png,images/kdyg/177-天然雀.png,images/kdyg/201-安侬.png,images/kdyg/140-化石盔.png,images/kdyg/191-向日种子.png,images/kdyg/074-小拳石.png,images/kdyg/383-古拉顿.png","image",function(){t.removeChild(e)})}});var i=new e;i.init()}();