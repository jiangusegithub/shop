var ZM=function(){this.type,this.posX,this.posY};ZM.prototype=new Sprite,JY.extend(ZM.prototype,{init:function(){switch((new Sprite).init.call(this),this.width=48,this.height=48,this.setStyle({width:this.width+"px",height:this.height+"px",border:"1px solid #ccc"}),this.type){case 0:this.setStyle({backgroundColor:"blue"});break;case 1:this.setStyle({backgroundColor:"red"});break;case 2:this.setStyle({backgroundColor:"green"});break;case 3:this.setStyle({backgroundColor:"#DDD"});break;case 4:this.setStyle({backgroundColor:"#999"});break;case 5:this.setStyle({backgroundColor:"#999"});break;case 6:this.setStyle({backgroundColor:"#999"});break;case 7:this.setStyle({backgroundColor:"#999"});break;case 8:this.setStyle({backgroundColor:"#999"});break;case 9:this.setStyle({backgroundColor:"#999"});break;case 10:this.setStyle({backgroundColor:"#999"});break;case 11:this.setStyle({backgroundColor:"#999"});break;default:this.setStyle({backgroundColor:"yellow"})}return this.setStyle({backgroundColor:"blue",background:"url(images/zuma/user"+this.type+".jpg) no-repeat center center",cursor:"pointer"}),this.x=50*this.posX,this.y=50*this.posY,this.setPosition(),this},select:function(){return this.setStyle({borderColor:"#000",opacity:.6,filter:"alpha(opacity=60)"}),JY.soundManage.play("select"),this},reset:function(){return this.setStyle({borderColor:"#ccc",opacity:1,filter:"alpha(opacity=100)"}),this}});var WordGame=function(){},game=function(){};game.prototype=new Game,g=new game,JY.extend(game.prototype,{newGame:function(){this.zumaArr=[],this.score=0,this.life=1e3,this.level=1,this.xMax=12,this.yMax=12,this.select=null,this.speed=5,this.step=50,this.typeCount=6,this.exchangeArr=[],this.deleteArr=[],this.initZuma(),this.setBg(),JY.soundManage.play("bg",!0)},setBg:function(){var e=parseInt(5*Math.random());JY.css(b.stage,{backgroundImage:"images/"+e+".jpg"})},runGame:function(){this.exchangeAnimate(),this.checkLife(),this.checkLevel(),this.life--},initZuma:function(){for(var e=0;e<this.xMax;e++){this.zumaArr[e]=[];for(var t=0;t<this.yMax;t++){var s=new ZM;s.posX=e,s.posY=t,s.type=Math.floor(Math.random()*this.typeCount),JY.innerHTML=s.type,s.init(),b.addChild(s),this.bindEvent(s),this.zumaArr[e][t]=s}}this.testZuma()},bindEvent:function(e){var t=this;JY.bind(e.DOM,"click",function(){t.select?1!=Math.abs(t.select.posX-e.posX)&&1!=Math.abs(t.select.posY-e.posY)||t.select.posX!=e.posX&&t.select.posY!=e.posY?(t.select.reset(),t.select=e.select()):(e.select(),e.fo={x:t.select.x,y:t.select.y,posX:t.select.posX,posY:t.select.posY},t.select.fo={x:e.x,y:e.y,posX:e.posX,posY:e.posY},t.exchangeArr.push({a:e,b:t.select}),delete t.select):t.select=e.select()})},exchange:function(e,t){var s=this,o=0;t.x=t.posX*s.step,t.y=t.posY*s.step,e.posX=t.posX,e.posX=t.posX,e.x-t.x<0?o=1:e.x-t.x>0&&(o=-1);var r=0;if(e.y-t.y<0?r=1:e.y-t.y>0&&(r=-1),e.x+=s.speed*o,e.y+=s.speed*r,1===o){if(e.x>=t.x)return e.x=t.x,e.setPosition(),s.zumaArr[e.posX][e.posY]=e,!0;e.setPosition()}if(-1===o){if(e.x<=t.x)return e.x=t.x,e.setPosition(),s.zumaArr[e.posX][e.posY]=e,!0;e.setPosition()}if(1===r){if(e.y>=t.y)return e.y=t.y,e.setPosition(),e.posY=t.posY,s.zumaArr[e.posX][e.posY]=e,!0;e.setPosition()}if(-1===r){if(e.y<=t.y)return e.y=t.y,e.setPosition(),e.posY=t.posY,s.zumaArr[e.posX][e.posY]=e,!0;e.setPosition()}return!1},exchangeAnimate:function(){for(var e=this,t=[],s=0,o=e.exchangeArr.length;o>s;s++)void 0!=e.exchangeArr[s]&&t.push(e.exchangeArr[s]);return e.exchangeArr=t,0==e.exchangeArr.length?!1:void JY.resolve(function(t,s){var o=t.a,r=t.b;o&&e.exchange(o,o.fo)&&(o.reset(),delete t.a),r&&e.exchange(r,r.fo)&&(r.reset(),delete t.b),t.a||t.b||(delete e.exchangeArr[s],e.testZuma())},0,e.exchangeArr.length,e.exchangeArr)},test:function(e){for(var t=[e],s=e.posX+1,o=this.zumaArr[e.posX].length;o>s;s++){var r=this.zumaArr[s][e.posY];if(!r||e.type!=r.type||e==r||r.isChecked)break;t.push(r)}this.check(t),t=[e];for(var s=e.posX-1;s>=0;s--){var r=this.zumaArr[s][e.posY];if(!r||e.type!=r.type||e==r||r.isChecked)break;t.push(r)}this.check(t),t=[e];for(var s=e.posY+1,o=this.zumaArr.length;o>s;s++){var r=this.zumaArr[e.posX][s];if(!r||e.type!=r.type||e==r||r.isChecked)break;t.push(r)}this.check(t),t=[e];for(var s=e.posY-1;s>=0;s--){var r=this.zumaArr[e.posX][s];if(!r||e.type!=r.type||e==r||r.isChecked)break;t.push(r)}this.check(t)},deleteCheck:function(){var e=this;if(this.deleteArr.length>=3){for(var t=0,s=this.deleteArr.length;s>t;t++){var o=this.deleteArr[t];o.isChecked=!0,b.removeChild(this.deleteArr[t]),delete this.zumaArr[o.posX][o.posY],delete this.deleteArr[t]}var r=this.deleteArr.length+parseInt(this.deleteArr.length/2);this.score+=r,this.life+=r,this.deleteArr=[],setTimeout(function(){e.createNew.call(e)},500),JY.soundManage.play("shit",!1)}},createNew:function(){for(var e=0,t=this.zumaArr.length;t>e;e++)for(var s=this.zumaArr[e],o=0,r=s.length;r>o;o++){var i=s[o];if(!i){var a=new ZM;a.posX=e,a.posY=o,a.type=Math.floor(5*Math.random()),JY.innerHTML=a.type,a.init(),b.addChild(a),this.bindEvent(a),this.zumaArr[e][o]=a}}this.testZuma()},check:function(e){e.length>=3&&(this.deleteArr=this.deleteArr.concat(e)),e=[]},testZuma:function(){for(var e=0,t=this.zumaArr.length;t>e;e++)for(var s=this.zumaArr[e],o=0,r=s.length;r>o;o++){var i=s[o];i&&!i.isChecked&&this.test(i)}this.deleteCheck()},checkLevel:function(){b.scoreScreen.innerHTML="时间："+this.life+" 得分："+this.score,this.score/this.level>100&&(this.setBg(),this.typeCount++,this.lifeTimer++)},checkLife:function(){if(this.life<=0){var e=parseInt(JY.cookie("dungeonScore"))||0;e=Math.max(e,this.score),JY.cookie("dungeonScore",e,30),b.gameOverScreen=JY.convertDOM('<div style="color:blue;padding:200px 200px;width:500px;margin:0 auto;"><h1>您的最后得分是 <strong>'+this.score+"</strong> 分</h1><p>历史最高得分是:<b>"+e+'</b>分</p><p>继续加油吧,点击重新开始游戏</p><p>更多游戏请<a href="http://www.lovewebgames.com">点击这里</a></p><div>'),b.checkState(JYGSTATE.STATE_SYSTEM_GAME_OVER),JY.soundManage.stop("bg"),JY.soundManage.play("gameover")}}}),WordGame.prototype=new JYG(JY.byId("gameboard")),JY.extend(WordGame.prototype,{init:function(){this.frequency=50,this.game=g,this.waitTime=5,this.checkState(JYGSTATE.STATE_SYSTEM_TITLE),this.startTimer(),this.titleScreen=JY.convertDOM('<div style="color:red;font-weight:bold;padding:200px 100px;width:300px;margin:0 auto;"><h1 style="color:red;font-weight:bold;">家庭祖玛-JY游戏</h1></div>'),this.InstructionsScreen=JY.convertDOM('<div style="color:blue;padding:200px;width:300px;margin:0 auto;"><h1 style="color:red;font-weight:bold;">家庭祖玛</h1><p>点击开始游戏</p><p>选中相邻的两个交换位置,当达到横向或竖向的三个相同家庭成员时得分,消掉得分图片重新生成.倒计时结束时,游戏也就结束了.<a href="http://www.lovewebgames.com" target="_blank" style="color:blue;">作者：田想兵55342775@qq.com</a></p></div>'),this.scoreScreen=JY.convertDOM('<div style="color:#FFF;width:200px;float:right;font-weight:bold;position:absolute;z-index:2;right:0;" id="scoreScreen"></div>'),JY.delegate(JY.byId("gameboard"),"a","mousedown",function(e){location.href=JY.attr(e.target,"href")});var e=JY.convertDOM('<p style="font-size:12px;color:#EEE;">资源正在加载中。。。</p>');this.addChild(e);var t=this;JY.loadFile("images/zuma/user1.jpg,images/zuma/user2.jpg,images/zuma/user3.jpg,images/zuma/user4.jpg,images/zuma/user5.jpg,images/zuma/user6.jpg,images/zuma/user7.jpg,images/zuma/user8.jpg,images/zuma/user9.jpg","image",function(){t.removeChild(e)}),JY.loadFile("../scripts/JY.cookie.js","script",function(){}),JY.soundManage.init("/scripts/swfobject.min.js","/scripts/flash/playSound.swf","playSound",function(){JY.soundManage.loadSound("sound/zuma/bg.mp3","bg"),JY.soundManage.loadSound("sound/zuma/gameover.mp3,sound/zuma/shit.mp3,sound/zuma/select.mp3","gameover,shit,select")})}});var b=new WordGame;b.init(),"www.lovewebgames.com"!==location.host&&"localhost"!==location.hostname&&"jsjy.cloudfoundry.com"!=location.host&&(location.href="http://www.lovewebgames.com");