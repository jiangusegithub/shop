var ZM=function(){this.type,this.posX,this.posY};ZM.prototype=new Sprite,JY.extend(ZM.prototype,{init:function(){switch((new Sprite).init.call(this),this.width=90,this.height=90,this.setStyle({width:this.width+"px",height:this.height+"px",border:"0px solid #ccc"}),this.setStyle({background:"url(images/crushcandy/candy.png) no-repeat center center",cursor:"pointer"}),this.type){case 0:this.setStyle({backgroundPosition:"-318px -510px"});break;case 1:this.setStyle({backgroundPosition:"-229px -232px"});break;case 2:this.setStyle({backgroundPosition:"-580px -905px"});break;case 3:this.setStyle({backgroundPosition:"-105px -618px"});break;case 4:this.setStyle({backgroundPosition:"-530px -440px"});break;case 5:this.setStyle({backgroundPosition:"-184px -910px"})}return this.x=90*this.posX,this.y=90*this.posY,this.setPosition(),this},select:function(){return this.setStyle({borderColor:"#000",opacity:.6,filter:"alpha(opacity=60)"}),this},reset:function(){return this.setStyle({borderColor:"#ccc",opacity:1,filter:"alpha(opacity=100)"}),this}});var WordGame=function(){},game=function(){};game.prototype=new Game,g=new game,JY.extend(game.prototype,{newGame:function(){this.zumaArr=[],this.score=0,this.life=1e3,this.level=1,this.xMax=12,this.yMax=12,this.select=null,this.speed=15,this.step=90,this.typeCount=6,this.exchangeArr=[],this.deleteArr=[],this.initZuma(),this.setBg(),this.selectObj1=null,this.selectObj2=null,this.resetPositionArr=[],JY.soundManage.play("bg",!0)},setBg:function(){var e=parseInt(5*Math.random());JY.css(b.stage,{backgroundImage:"images/"+e+".jpg"})},runGame:function(){this.exchangeAnimate(),this.checkLife(),this.checkLevel(),this.life--,this.resetPosition()},initZuma:function(){for(var e=0;e<this.xMax;e++){this.zumaArr[e]=[];for(var t=0;t<this.yMax;t++){var s=new ZM;s.posX=e,s.posY=t,s.type=Math.floor(Math.random()*this.typeCount),JY.innerHTML=s.type,s.init(),b.addChild(s),this.bindEvent(s),this.zumaArr[e][t]=s}}this.testZuma()},bindEvent:function(e){var t=this;JY.bind(e.DOM,"click",function(){t.select?1!=Math.abs(t.select.posX-e.posX)&&1!=Math.abs(t.select.posY-e.posY)||t.select.posX!=e.posX&&t.select.posY!=e.posY?(t.select.reset(),t.select=e.select()):(e.select(),t.selectObj2=e,e.fo={x:t.select.x,y:t.select.y,posX:t.select.posX,posY:t.select.posY},t.select.fo={x:e.x,y:e.y,posX:e.posX,posY:e.posY},t.exchangeArr.push({a:e,b:t.select}),delete t.select):(t.select=e.select(),t.selectObj1=e)})},exchange:function(e,t){var s=this,i=0;t.x=t.posX*s.step,t.y=t.posY*s.step,e.posX=t.posX,e.posX=t.posX,e.x-t.x<0?i=1:e.x-t.x>0&&(i=-1);var o=0;if(e.y-t.y<0?o=1:e.y-t.y>0&&(o=-1),e.x+=s.speed*i,e.y+=s.speed*o,1===i){if(e.x>=t.x)return e.x=t.x,e.setPosition(),s.zumaArr[e.posX][e.posY]=e,!0;e.setPosition()}if(-1===i){if(e.x<=t.x)return e.x=t.x,e.setPosition(),s.zumaArr[e.posX][e.posY]=e,!0;e.setPosition()}if(1===o){if(e.y>=t.y)return e.y=t.y,e.setPosition(),e.posY=t.posY,s.zumaArr[e.posX][e.posY]=e,!0;e.setPosition()}if(-1===o){if(e.y<=t.y)return e.y=t.y,e.setPosition(),e.posY=t.posY,s.zumaArr[e.posX][e.posY]=e,!0;e.setPosition()}return!1},exchangeAnimate:function(){for(var e=this,t=[],s=0,i=e.exchangeArr.length;i>s;s++)void 0!=e.exchangeArr[s]&&t.push(e.exchangeArr[s]);return e.exchangeArr=t,0==e.exchangeArr.length?!1:void JY.resolve(function(t,s){var i=t.a,o=t.b;i&&e.exchange(i,i.fo)&&(i.reset(),delete t.a),o&&e.exchange(o,o.fo)&&(o.reset(),delete t.b),t.a||t.b||(e.testZuma(),delete e.exchangeArr[s])},0,e.exchangeArr.length,e.exchangeArr)},test:function(e){for(var t=[e],s=e.posX+1,i=this.zumaArr[e.posX].length;i>s;s++){var o=this.zumaArr[s][e.posY];if(!o||e.type!=o.type||e==o||o.isChecked)break;t.push(o)}this.check(t),t=[e];for(var s=e.posX-1;s>=0;s--){var o=this.zumaArr[s][e.posY];if(!o||e.type!=o.type||e==o||o.isChecked)break;t.push(o)}this.check(t),t=[e];for(var s=e.posY+1,i=this.zumaArr.length;i>s;s++){var o=this.zumaArr[e.posX][s];if(!o||e.type!=o.type||e==o||o.isChecked)break;t.push(o)}this.check(t),t=[e];for(var s=e.posY-1;s>=0;s--){var o=this.zumaArr[e.posX][s];if(!o||e.type!=o.type||e==o||o.isChecked)break;t.push(o)}this.check(t)},deleteCheck:function(){var e=this;if(this.deleteArr.length>=3){for(var t=0,s=this.deleteArr.length;s>t;t++){var i=this.deleteArr[t];i.isChecked=!0,b.removeChild(this.deleteArr[t]),delete this.zumaArr[i.posX][i.posY],delete this.deleteArr[t]}var o=this.deleteArr.length+parseInt(this.deleteArr.length/2);this.score+=o,this.life+=o,this.deleteArr=[],setTimeout(function(){e.createNew.call(e)},500),JY.soundManage.play("shit",!1),e.selectObj1=null}else e.selectObj1&&e.selectObj2&&(e.selectObj1.fo={x:e.selectObj2.x,y:e.selectObj2.y,posX:e.selectObj2.posX,posY:e.selectObj2.posY},e.selectObj2.fo={x:e.selectObj1.x,y:e.selectObj1.y,posX:e.selectObj1.posX,posY:e.selectObj1.posY},e.resetPositionArr.push({a:e.selectObj1,b:e.selectObj2}))},resetPosition:function(){for(var e=this,t=[],s=0,i=e.resetPositionArr.length;i>s;s++)void 0!=e.resetPositionArr[s]&&t.push(e.resetPositionArr[s]);return e.resetPositionArr=t,0==e.resetPositionArr.length?!1:void JY.resolve(function(t,s){var i=t.a,o=t.b;i&&e.exchange(i,i.fo)&&(i.reset(),delete t.a),o&&e.exchange(o,o.fo)&&(o.reset(),delete t.b),t.a||t.b||delete e.resetPositionArr[s]},0,e.resetPositionArr.length,e.resetPositionArr)},createNew:function(){for(var e=0,t=this.zumaArr.length;t>e;e++)for(var s=this.zumaArr[e],i=0,o=s.length;o>i;i++){var r=s[i];if(!r){var n=new ZM;n.posX=e,n.posY=i,n.type=Math.floor(5*Math.random()),JY.innerHTML=n.type,n.init(),b.addChild(n),this.bindEvent(n),this.zumaArr[e][i]=n}}this.testZuma()},check:function(e){e.length>=3&&(this.deleteArr=this.deleteArr.concat(e)),e=[]},testZuma:function(){for(var e=0,t=this.zumaArr.length;t>e;e++)for(var s=this.zumaArr[e],i=0,o=s.length;o>i;i++){var r=s[i];r&&!r.isChecked&&this.test(r)}this.deleteCheck()},checkLevel:function(){b.scoreScreen.innerHTML="时间："+this.life+" 得分："+this.score,this.score/this.level>100&&(this.setBg(),this.typeCount++,this.lifeTimer++)},checkLife:function(){if(this.life<=0){var e=parseInt(JY.cookie("dungeonScore"))||0;e=Math.max(e,this.score),JY.cookie("dungeonScore",e,30),b.gameOverScreen=JY.convertDOM('<div style="color:blue;width:100%;height:100%;position:relative;color:#FFFFFF;background:url(images/crushcandy/main_menu.png) no-repeat;margin:0 auto;"><div style="position:absolute;top:350px;left:280px;"><h1>您的最后得分是 <strong>'+this.score+"</strong> 分</h1><p>历史最高得分是:<b>"+e+'</b>分</p><p>继续加油吧,点击重新开始游戏</p><p>更多游戏请<a href="http://www.lovewebgames.com">点击这里</a></p></div><div>'),b.checkState(JYGSTATE.STATE_SYSTEM_GAME_OVER)}}}),WordGame.prototype=new JYG(JY.byId("gameboard")),JY.extend(WordGame.prototype,{init:function(){this.frequency=50,this.game=g,this.waitTime=5,this.checkState(JYGSTATE.STATE_SYSTEM_TITLE),this.startTimer(),this.titleScreen=JY.convertDOM('<div style="color:red;font-weight:bold;text-align:center;padding-top:50px;width:100%;margin:0 auto;"><img src="images/crushcandy/loading_logo.png"/><h1 style="color:red;font-weight:bold;">糖果粉碎-JY游戏</h1></div>'),this.InstructionsScreen=JY.convertDOM('<div style="margin:0 auto;background:url(images/crushcandy/main_menu.png) no-repeat;height:100%;width:100%;position:relative;"><span style="display:block;cursor:pointer;width:275px;height:110px;background:url(images/crushcandy/level_menu.png) -341px -434px no-repeat;line-height:100px;font-family: Tahoma,宋体;text-align:center;font-size:28px;font-weight:bolder;color:#FFFFFF;top:350px;left:280px;position:absolute;">Play</span><p style="position:absolute;top:450px;left:280px;"><a href="http://www.lovewebgames.com" target="_blank" style="color:#fff797;">作者：田想兵55342775@qq.com</a></p></div>'),this.scoreScreen=JY.convertDOM('<div style="color:#FFF;width:200px;float:right;font-weight:bold;position:absolute;z-index:2;right:0;" id="scoreScreen"></div>'),JY.delegate(JY.byId("gameboard"),"a","mousedown",function(e){location.href=JY.attr(e.target,"href")});var e=JY.convertDOM('<p style="font-size:12px;color:#EEE;">资源正在加载中。。。</p>');this.addChild(e);var t=this;JY.loadFile("images/crushcandy/candy.png,images/crushcandy/main_menu.png,images/crushcandy/loading_logo.png","image",function(){t.removeChild(e)}),JY.loadFile("../scripts/JY.cookie.js","script",function(){}),JY.soundManage.init("/scripts/swfobject.min.js","/scripts/flash/playSound.swf","playSound",function(){JY.soundManage.loadSound("sound/zuma/bg.mp3","bg"),JY.soundManage.loadSound("sound/zuma/shit.mp3","shit")})}});var b=new WordGame;b.init(),"www.lovewebgames.com"!==location.host&&"localhost"!==location.host&&"jsjy.cloudfoundry.com"!=location.host&&(location.href="http://www.lovewebgames.com");