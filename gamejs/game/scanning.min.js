!function(t){var e=function(){},i=function(){};i.prototype=new Game,g=new i,t.extend(i.prototype,{newGame:function(){this.now=+new Date,this.blockList=[],this.life=3,this.level=1,this.timer=0,this.x=10,this.y=15,this.open=-1,this.scoreTool,this.drawToolbar(),this.drawMap(),this.scaning(),t.addClass(o.stage,"start"),this.bindEvent()},bindEvent:function(){var e=this;t.off(o.stage,"touchstart","i.block"),t.on(o.stage,"touchstart","i.block",function(t){e.select.call(this,t,e)}),t.off(o.stage,"mousedown","i.block"),t.on(o.stage,"mousedown","i.block",function(t){e.select.call(this,t,e)})},select:function(e,i){var o=this.data,s=this.position.x,h=this.position.y;"boom"==o.type?(t.addClass(o.DOM,"boom"),setTimeout(function(){i.life--},200)):(delete i.blockList[s][h],0==o.type?(o.remove(),i.fuckOther(s,h)):(t.text(o.DOM,o.type),t.addClass(o.DOM,"open"))),i.checkLevel()},fuckOther:function(t,e){var i=this,o=this.blockList[t],s=(o[e],this.blockList.length),h=o.length;if(0!==e){var a=o[e-1];a&&0==a.type&&(a.remove(),delete i.blockList[t][e-1],i.fuckOther(t,e-1))}if(e!==h-1){var r=o[e+1];r&&0==r.type&&(r.remove(),delete i.blockList[t][e+1],i.fuckOther(t,e+1))}if(0!==t){var c=this.blockList[t-1][e];c&&0==c.type&&(c.remove(),delete i.blockList[t-1][e],i.fuckOther(t-1,e))}if(t!==s-1){var n=this.blockList[t+1][e];n&&0==n.type&&(n.remove(),delete i.blockList[t+1][e],i.fuckOther(t+1,e))}},scaning:function(){for(var t=0,e=this.blockList.length;e>t;t++)for(var i=this.blockList[t],o=0,s=i.length;s>o;o++){var h=i[o];if("boom"!=h.type){var a=0;if(0!==o){var r=i[o-1];if("boom"==r.type&&a++,0!==t){var c=this.blockList[t-1][o-1];"boom"==c.type&&a++}if(t!==e-1){var n=this.blockList[t+1][o-1];"boom"==n.type&&a++}}if(o!==s-1){var l=i[o+1];if("boom"==l.type&&a++,0!==t){var p=this.blockList[t-1][o+1];"boom"==p.type&&a++}if(t!==e-1){var f=this.blockList[t+1][o+1];"boom"==f.type&&a++}}if(0!==t){var v=this.blockList[t-1][o];"boom"==v.type&&a++}if(t!==e-1){var d=this.blockList[t+1][o];"boom"==d.type&&a++}h.type=a}}},coutTimer:function(){var e=+new Date,i=e-this.now;this.timer=i/1e3,t.text(this.scoreTool.DOM,"时间："+this.timer+" s")},drawToolbar:function(){this.scoreTool=new Sprite(140,30),this.scoreTool.setPosition(o.stage.width/2-70,o.stage.height-30),t.text(this.scoreTool.DOM,"时间:0"),o.addChild(this.scoreTool)},drawMap:function(){this.blockList=[];for(var e=Math.floor(o.stage.width/this.x),i=e,s=0;s<this.y;s++){for(var h=[],a=0;a<this.x;a++){var r=new Sprite(e,i);t.addClass(r.DOM,"block"),r.setPosition(a*e,s*i);var c=1e3*Math.random();r.type=0,r.DOM.data=r,r.DOM.position={x:s,y:a},c<150*this.level&&(r.type="boom"),o.addChild(r),h.push(r)}this.blockList.push(h)}},runGame:function(){this.coutTimer(),this.checkLife()},checkLevel:function(){var e=!0;if(t.each(this.blockList,function(i,o){t.each(i,function(t,i){t&&"boom"!==t.type&&(e=!1)})}),e){this.level++,o.clearState();var i=this;i.levelup()}},levelup:function(){this.drawToolbar(),this.drawMap(),this.scaning(),o.startTimer()},checkLife:function(){if(this.life<=0){o.checkState(JYGSTATE.STATE_SYSTEM_GAME_OVER);var e=o.stage.height/3,i=50;o.gameOverScreen=t.convertDOM('<div style="color:#555;width:300px;margin:0 auto;position:absolute;top:'+e+"px;left:"+i+'px;"><h1>游戏结束!</h1><p>在本次游戏中您共通关'+(this.level-1)+"关,总耗时"+this.timer+"秒,截图炫耀吧!</p><p>点击重新开始游戏</p></div>")}t.html(o.scoreScreen,"生命值:"+this.life)}}),e.prototype=new JYG(t.byId("gameboard")),t.extend(e.prototype,{init:function(){this.game=g,this.frequency=30,this.waitTime=5,this.checkState(JYGSTATE.STATE_SYSTEM_TITLE),this.startTimer(),o.stage.width>768&&(o.stage.width=768,t.width(o.stage,768));var e=this.stage.height/3,i=50;this.titleScreen=t.convertDOM('<div style="color:#555;width:300px;margin:0 auto;position:absolute;top:'+e+"px;left:"+i+'px;"><h1>扫雷</h1></div>'),this.InstructionsScreen=t.convertDOM('<div style="color:#555;width:300px;margin:0 auto;position:absolute;top:'+e+"px;left:"+i+'px;"><h1>扫雷</h1><p>点击开始游戏</p>作者：田想兵55342775@qq.com</div>'),this.scoreScreen=t.convertDOM('<div style="color:#555;width:100px;position:absolute;bottom:10px;right:0;" id="scoreScreen"></div>');var s=1.5*o.stage.width;t.height(o.stage,s)}});var o=new e;o.init()}(JY);