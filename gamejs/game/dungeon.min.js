var WordGame=function(){},game=function(){};game.prototype=new Game,g=new game,JY.extend(game.prototype,{newGame:function(){this.floorArr=[],this.level=1,this.speed=5,this.userSpeed=12,this.vx=0,this.ax=1.2,this.score=0,this.life=5,this.user=new Sprite,this.userSpeedY=8,this.ay=1.05,b.checkState(JYGSTATE.STATE_SYSTEM_NEW_LEVEL),this.counter=0,this.createUser(),this.animateUserFor=0,this.animateNum=0,this.wd=0,this.jump=0,this.jumpy=.9,this.by=0},runGame:function(){this.checkLife(),this.checkLevel(),this.createFloor(0),this.createFloor(1),this.createFloor(2),this.moveFloor(),this.fallUser(),this.counter++,this.playUser(),this.moveRole()},createUser:function(){var e=new Sprite(160,16,{background:"url(images/dungeon/floor.png) "});JY.addClass(e.DOM,"floor");var t=JY.width(b.stage)/3;e.setPosition(t,JY.height(b.stage)-e.height),this.floorArr.push(e),b.addChild(e),this.user=new Sprite(40,55,{border:"none",background:"url(images/dungeon/role.png) no-repeat"}),this.user.setPosition(e.x+e.width/2-this.user.width/2,JY.height(b.stage)-this.user.height-e.height),b.addChild(this.user),this.user.data=e,e.data=this.user},wdUser:function(){var e=this;e.life--,e.wd=15,e.user.setStyle({opacity:.5,filter:"alpha(opacity=50)"})},moveFloor:function(){var e=this;JY.resolve(function(t,s){this.y-=e.speed,this.data?(1==this.type?(this.data.setPosition(null,this.y-this.data.height+10),e.wd<=0&&e.wdUser()):this.data.setPosition(null,this.y-this.data.height+5),(2==this.type||3==this.type)&&(e.jump=33,e.user.data=null,this.data=null)):JY.hits(t,e.user)&&(console.log("接上1"),e.user.data=t,t.data=e.user,e.userSpeedY=8,1!=t.type||e.wd||e.wdUser()),this.setPosition(this.x,this.y),this.y<-this.height&&(b.removeChild(e.floorArr[s].DOM),delete e.floorArr[s]),e.user.y<-e.user.height&&e.life--},0,e.floorArr.length,e.floorArr)},fallUser:function(){this.user.data||(this.userSpeedY*=this.ay,this.user.setPosition(null,this.user.y+this.userSpeedY),this.user.y>JY.height(b.stage)&&(this.life=0))},createFloor:function(e){var t=Math.floor(100*Math.random());if(t>60&&this.counter+this.level>20){var s={},i=Math.floor(100*Math.random())%10;switch(i){case 1:s=new Sprite(160,30,{background:"url(images/dungeon/bad.png) no-repeat"});break;case 2:case 3:s=new Sprite(160,30,{background:"url(images/dungeon/jump2.png) no-repeat"});break;default:s=new Sprite(160,16,{background:"url(images/dungeon/floor.png) no-repeat"})}s.type=i,JY.addClass(s.DOM,"floor");var o=200*e;s.setPosition(o,JY.height(b.stage)),this.floorArr.push(s),b.addChild(s),this.counter=0,this.score++}},checkUserFloor:function(e){this.user.data&&(this.user.data&&e>this.user.data.x+this.user.data.width&&(this.user.data.data=null,this.user.data=null,console.log("掉落1")),this.user.data&&e<this.user.data.x-this.user.width&&(this.user.data.data=null,this.user.data=null,console.log("掉落2")))},moveBack:function(){JY.css(b.stage,{backgroundPosition:"0 "+this.by+"px"}),this.by-=this.speed,this.by>600&&(this.by=0)},playUser:function(){if(this.animateUserFor){var e=40*-this.animateNum,t=55*-this.animateUserFor;this.user.setStyle({backgroundPosition:e+"px "+t+"px"}),this.animateNum++,this.animateNum>4&&(this.user.setStyle({backgroundPosition:"0px 0px"}),this.animateNum=0,this.animateUserFor=null)}this.wd>0&&(this.wd--,this.wd<=0&&this.user.setStyle({opacity:1,filter:"alpha(opacity=100)"}))},moveRole:function(){0!=this.vx&&(this.vx*=this.ax,this.user.x+=this.vx,this.user.x=Math.max(this.user.x,0),this.user.x=Math.min(this.user.x,this.user.x,JY.width(b.stage)-this.user.width),this.user.setPosition(this.user.x),this.animateUserFor=this.vx<0?1:2,this.checkUserFloor(this.user.x)),this.jump>0&&(this.jump*=this.jumpy,this.user.y-=this.jump,this.user.setPosition(null,this.user.y))},EventUpUser:function(e){e=e.keyCode,(37==e||65==e)&&(this.vx<0?this.vx=0:null),(39==e||68==e)&&(this.vx>0?this.vx=0:null),38==e&&(console.log("x:"+this.user.x),console.log("fx:"+this.data))},moveUser:function(e){(37==e||65==e)&&(this.vx=-10),(39==e||68==e)&&(this.vx=10)},checkLevel:function(){b.scoreScreen.innerHTML="生命："+this.life+" 得分："+this.score,this.score/this.level>5&&(this.level++,this.speed++)},checkLife:function(){if(this.life<=0){var e=parseInt(JY.cookie("dungeonScore"))||0;e=Math.max(e,this.score),JY.cookie("dungeonScore",e,30),b.gameOverScreen=JY.convertDOM('<div style="color:#EEE;padding:200px 200px;width:500px;margin:0 auto;"><h1>您最后下到了地狱 <strong>'+this.score+"</strong> 层</h1><p>最厉害的一次你下到了<b>"+e+'</b>层</p><p>点击重新开始游戏</p><p>更多游戏请<a href="http://www.lovewebgames.com">点击这里</a></p><div>'),b.checkState(JYGSTATE.STATE_SYSTEM_GAME_OVER)}}}),WordGame.prototype=new JYG(JY.byId("gameboard")),JY.extend(WordGame.prototype,{init:function(){this.frequency=50,this.game=g,this.waitTime=5,this.checkState(JYGSTATE.STATE_SYSTEM_TITLE),this.startTimer(),this.titleScreen=JY.convertDOM('<div style="color:#eee;padding:200px 100px;width:300px;margin:0 auto;"><h1>地下一百层-是男人就下到一百层</h1></div>'),this.InstructionsScreen=JY.convertDOM('<div style="color:#eee;padding:200px;width:300px;margin:0 auto;"><h1>地下一百层-是男人就下到一百层</h1><p>点击开始游戏</p><p>方向键左右移动英雄<a href="http://www.lovewebgames.com" target="_blank">作者：田想兵55342775@qq.com</a></p></div>'),this.scoreScreen=JY.convertDOM('<div style="color:#eee;width:150px;float:right;" id="scoreScreen"></div>'),JY.bind(document,"keydown",function(e){g.moveUser(e.keyCode)}).bind(document,"keyup",JY.proxyFunc(g.EventUpUser,g)),JY.delegate(JY.byId("gameboard"),"a","mousedown",function(e){location.href=JY.attr(e.target,"href")});var e=JY.convertDOM('<p style="font-size:12px;">资源正在加载中。。。</p>');this.addChild(e);var t=this;JY.loadFile("images/dungeon/floor.png,images/dungeon/bad.png,images/dungeon/jump2.png,images/dungeon/role.png","image",function(){t.removeChild(e)}),JY.loadFile("/scripts/JY.cookie.js","script"),JY.soundManage.init("/scripts/swfobject.min.js","/scripts/flash/playSound.swf","playSound",function(){JY.soundManage.loadSound("sound/dungeon/bg.mp3","bg").done(function(){JY.soundManage.play("bg")})})}});var b=new WordGame;b.init(),"www.lovewebgames.com"!==location.host&&"localhost"!==location.host,JY.hits({x:200,y:309,width:160,height:16},{x:137,y:305,width:40,height:55});